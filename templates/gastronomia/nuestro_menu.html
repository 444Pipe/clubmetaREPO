{% extends 'base.html' %}
{% load static %}
{% block title %}Nuestro Menú - CLUB EL META{% endblock %}
{% block content %}
<div class="container py-5">
  <div class="d-flex align-items-start justify-content-between mb-3">
    <div>
      <h1 class="mb-1">Nuestro Menú</h1>
      <p class="fs-5 mb-0">Presentamos una selección representativa de opciones gastronómicas disponibles para eventos y consumo en el club. Para consultar el menú completo y solicitar cotización, por favor contacta al restaurante: <a href="tel:+573108824473">310 882 4473</a>.</p>
    </div>
    <div class="ms-3">
      <a id="btn-download-top" href="{% static 'pdf/MENU_CLUB_META_2026.pdf' %}" download class="btn btn-lg btn-primary">
        <i class="bi bi-download me-2"></i> Descargar Menú (PDF)
      </a>
    </div>
  </div>

  <h2 class="mt-4">Galería del Menú</h2>

  <!-- Toolbar removed per user request -->

  <div class="menu-stack mt-3" id="menuStack">
    <div class="menu-page" data-page="1"><img src="{% static 'img/menu/menu1.jpeg' %}" alt="Menú 1"><div class="page-label">Página 1</div></div>
    <div class="menu-page" data-page="2"><img src="{% static 'img/menu/menu2.jpeg' %}" alt="Menú 2"><div class="page-label">Página 2</div></div>
    <div class="menu-page" data-page="3"><img src="{% static 'img/menu/menu3.jpeg' %}" alt="Menú 3"><div class="page-label">Página 3</div></div>
    <div class="menu-page" data-page="4"><img src="{% static 'img/menu/menu4.jpeg' %}" alt="Menú 4"><div class="page-label">Página 4</div></div>
    <div class="menu-page" data-page="5"><img src="{% static 'img/menu/menu5.jpeg' %}" alt="Menú 5"><div class="page-label">Página 5</div></div>
    <div class="menu-page" data-page="6"><img src="{% static 'img/menu/menu6.jpeg' %}" alt="Menú 6"><div class="page-label">Página 6</div></div>
    <div class="menu-page" data-page="7"><img src="{% static 'img/menu/menu7.jpeg' %}" alt="Menú 7"><div class="page-label">Página 7</div></div>
    <div class="menu-page" data-page="8"><img src="{% static 'img/menu/menu8.jpeg' %}" alt="Menú 8"><div class="page-label">Página 8</div></div>
    <div class="menu-page" data-page="9"><img src="{% static 'img/menu/menu9.jpeg' %}" alt="Menú 9"><div class="page-label">Página 9</div></div>
  </div>
</div>

<!-- Lightbox modal -->
<div id="menuModal" class="menu-modal" hidden>
  <div class="menu-modal-backdrop"></div>
  <div class="menu-modal-inner">
    <button id="modalClose" class="btn-close-modal" aria-label="Cerrar">×</button>
    <div class="menu-modal-content">
      <img id="modalImg" src="" alt="Menú ampliado">
    </div>
    <div class="menu-modal-controls">
      <button id="zoomIn" class="btn btn-sm btn-outline-secondary">+</button>
      <button id="zoomOut" class="btn btn-sm btn-outline-secondary">−</button>
      <a id="downloadBtn" class="btn btn-sm btn-primary" download>Descargar</a>
    </div>
  </div>
</div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  /* Layout */
  body { background: #f3f4f6; }
  .container.py-5 { max-width: 1100px; }

  /* Stacked pages: scrollable area with snap for PDF-like feel */
  .menu-stack { display: block; width: 100%; max-width: 100%; max-height: calc(100vh - 220px); overflow-y: auto; padding: 1rem; box-sizing: border-box; scroll-behavior: smooth; scroll-snap-type: y mandatory; }
  .menu-page { scroll-snap-align: start; width: 100%; max-width: 980px; margin: 0 auto; box-shadow: 0 12px 40px rgba(2,6,23,0.08); border-radius: 10px; overflow: hidden; background: #fff; position: relative; transition: transform 0.25s ease; }
  .menu-page:hover { transform: translateY(-6px); }
  .menu-page img { width: 100%; height: auto; display: block; }
  @media (max-width: 576px) { .menu-page { max-width: 100%; border-radius: 6px; } }

  /* Toolbar removed */

  /* Page label */
  .page-label { position: absolute; right: 12px; bottom: 12px; background: rgba(0,0,0,0.6); color: #fff; padding: 6px 10px; border-radius: 6px; font-size: 0.9rem; }

  /* Fit width mode */
  .fit-width .menu-page { max-width: 100% !important; border-radius: 0; }

  /* Modal / Lightbox */
  .menu-modal { position: fixed; inset: 0; display: grid; place-items: center; z-index: 2000; }
  .menu-modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.75); }
  .menu-modal-inner { position: relative; width: min(1200px, 95%); max-height: 95vh; background: transparent; display:flex; flex-direction:column; gap:8px; }
  .menu-modal-content { flex: 1 1 auto; display:flex; align-items:center; justify-content:center; overflow:auto; }
  .menu-modal-content img { max-width: 100%; max-height: 88vh; border-radius: 6px; box-shadow: 0 20px 60px rgba(2,6,23,0.6); transform-origin: center center; transition: transform 0.18s ease; }
  .btn-close-modal { position: absolute; right: 8px; top: 8px; z-index: 2010; background: rgba(255,255,255,0.9); border: none; width: 40px; height: 40px; border-radius: 8px; font-size: 20px; }
  .menu-modal-controls { display:flex; gap:8px; justify-content:flex-end; }
  .menu-modal-controls .btn { min-width: 46px; }
</style>
{% endblock %}
{% block extra_js %}
<script>
  (function(){
    const pages = Array.from(document.querySelectorAll('.menu-page'));
    const stack = document.getElementById('menuStack');
    let idx = 0;
    function scrollToIndex(i){
      i = Math.max(0, Math.min(pages.length-1, i));
      idx = i;
      pages[idx].scrollIntoView({behavior:'smooth', block:'start'});
    }

    // Toolbar buttons removed — navigation still available via keyboard and scroll

    // Lightbox modal elements
    const modal = document.getElementById('menuModal');
    const modalImg = document.getElementById('modalImg');
    const modalClose = document.getElementById('modalClose');
    const downloadBtn = document.getElementById('downloadBtn');
    const zoomIn = document.getElementById('zoomIn');
    const zoomOut = document.getElementById('zoomOut');
    let scale = 1;

    // Open modal on image click
    pages.forEach(p=>{
      const img = p.querySelector('img');
      img.style.cursor = 'zoom-in';
      img.addEventListener('click', ()=>{
        modalImg.src = img.src;
        downloadBtn.href = img.src;
        scale = 1; modalImg.style.transform = 'scale(1)';
        modal.removeAttribute('hidden');
        document.body.style.overflow = 'hidden';
      });
    });

    function closeModal(){ modal.setAttribute('hidden',''); document.body.style.overflow = ''; }
    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target===modal || e.target.classList.contains('menu-modal-backdrop')) closeModal(); });

    zoomIn.addEventListener('click', ()=>{ scale = Math.min(3, scale + 0.25); modalImg.style.transform = `scale(${scale})`; });
    zoomOut.addEventListener('click', ()=>{ scale = Math.max(0.5, scale - 0.25); modalImg.style.transform = `scale(${scale})`; });

    // Keyboard navigation and modal close
    window.addEventListener('keydown', (e)=>{
      if(modal && !modal.hasAttribute('hidden')){
        if(e.key==='Escape'){ closeModal(); }
        if(e.key==='+'||e.key==='=') { e.preventDefault(); scale = Math.min(3, scale + 0.25); modalImg.style.transform = `scale(${scale})`; }
        if(e.key==='-') { e.preventDefault(); scale = Math.max(0.5, scale - 0.25); modalImg.style.transform = `scale(${scale})`; }
        return;
      }
      if(['ArrowDown','PageDown'].includes(e.key)) { e.preventDefault(); scrollToIndex(idx+1); }
      if(['ArrowUp','PageUp'].includes(e.key)) { e.preventDefault(); scrollToIndex(idx-1); }
      if(e.key==='Home'){ e.preventDefault(); scrollToIndex(0); }
      if(e.key==='End'){ e.preventDefault(); scrollToIndex(pages.length-1); }
    });

    // Update idx while scrolling inside stack
    let ticking=false;
    stack.addEventListener('scroll', ()=>{
      if(ticking) return; ticking=true;
      requestAnimationFrame(()=>{
        const mid = stack.scrollTop + stack.clientHeight/8;
        let nearest = 0; let minDist = Infinity;
        pages.forEach((p,i)=>{
          const top = p.offsetTop;
          const dist = Math.abs(top - mid);
          if(dist < minDist){ minDist = dist; nearest = i; }
        });
        idx = nearest;
        ticking=false;
      });
    });
  })();
</script>
{% endblock %}

